<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Bếp - Danh sách món | PTT Team</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body { height: 100vh; overflow: hidden; background-color: #fff; font-family: 'Segoe UI', sans-serif; }

        /* Header */
        .kitchen-header { height: 60px; border-bottom: 2px solid #333; display: flex; justify-content: space-between; align-items: center; padding: 0 30px; }
        .site-title { font-weight: bold; font-size: 1.2rem; text-transform: uppercase; }
        .header-icons i { font-size: 1.5rem; margin-left: 20px; color: #333; cursor: pointer; }

        /* Layout */
        .kitchen-container { display: flex; height: calc(100vh - 60px); }
        .col-waiting { flex: 1; border-right: 2px solid #333; display: flex; flex-direction: column; background: #fcfcfc; }
        .col-cooking { flex: 1; display: flex; flex-direction: column; background: #fff; }

        /* Col Header */
        .col-header { padding: 20px 20px 0 20px; display: flex; justify-content: space-between; align-items: flex-end; border-bottom: 1px solid #eee; }
        .col-title { font-family: 'Courier New', monospace; font-weight: bold; font-size: 1.5rem; color: #555; margin-bottom: 10px; }

        /* Tabs */
        .tab-group { display: flex; gap: 5px; }
        .nav-tab-item { padding: 8px 25px; border: 1px solid #ccc; border-bottom: 2px solid #333; border-radius: 10px 10px 0 0; color: #aaa; text-decoration: none; font-weight: bold; background: #f9f9f9; font-size: 0.9rem; }
        .nav-tab-item.active { border: 2px solid #333; border-bottom: 2px solid #fcfcfc; color: #333; background: #fcfcfc; position: relative; top: 2px; z-index: 2; }

        /* Task List */
        .task-list { flex-grow: 1; overflow-y: auto; padding: 20px; }

        /* Card */
        .task-card { border: 2px solid #333; border-radius: 10px; padding: 15px; margin-bottom: 20px; background: white; position: relative; box-shadow: 4px 4px 0px rgba(0,0,0,0.1); transition: transform 0.2s; }
        .task-card:hover { transform: translateY(-2px); }

        .task-info { margin-bottom: 10px; max-width: 70%; }
        .dish-name { font-weight: 800; font-size: 1.3rem; display: flex; align-items: center; gap: 10px; }
        .dish-qty { background: #333; color: white; padding: 2px 8px; border-radius: 5px; font-size: 1rem; }
        .dish-meta { color: #666; font-size: 0.95rem; font-family: monospace; margin-top: 5px; }
        .dish-note { color: #dc3545; font-style: italic; font-weight: 600; margin-top: 5px; border-left: 3px solid #dc3545; padding-left: 8px; }

        /* Button */
        .btn-action { border: 2px solid #333; background: white; color: #333; font-weight: bold; padding: 8px 20px; border-radius: 8px; position: absolute; right: 15px; top: 50%; transform: translateY(-50%); cursor: pointer; transition: 0.2s; text-transform: lowercase; }
        .btn-action:hover { background: #333; color: white; }
        .btn-done { background: #333; color: white; }
        .btn-done:hover { background: #555; border-color: #555; }

        .logout-btn { position: fixed; bottom: 20px; left: 20px; font-size: 1.2rem; color: #333; text-decoration: none; font-weight: bold; display: flex; align-items: center; gap: 10px; z-index: 100; }
        .logout-btn:hover { color: #dc3545; }
    </style>
</head>
<body>

<div class="kitchen-header">
    <div class="d-flex gap-2">
        <div style="width:12px;height:12px;border:2px solid #333;border-radius:50%;"></div>
        <div style="width:12px;height:12px;border:2px solid #333;border-radius:50%;"></div>
        <div style="width:12px;height:12px;border:2px solid #333;border-radius:50%;"></div>
    </div>
    <div class="site-title">Nhà bếp: {{ user }}</div>

    <div class="header-icons">
        <i class="far fa-bell"></i>
    </div>
</div>

<div class="kitchen-container">

    <div class="col-waiting">
        <div class="col-header">
            <div class="col-title">waiting to cook</div>
            <div class="tab-group">
                <a href="{{ url_for('main.bep', mode='order') }}" class="nav-tab-item {% if mode == 'order' %}active{% endif %}">Order</a>
                <a href="{{ url_for('main.bep', mode='dish') }}" class="nav-tab-item {% if mode == 'dish' %}active{% endif %}">Dish</a>
            </div>
        </div>
        <div style="height: 2px; background: #333; width: 100%; margin-top: -2px; z-index: 1;"></div>

        <div class="task-list">
            {% for item in waiting_list %}
                {% if item.IsAggregated %}
                    <div class="task-card" style="border-color: #ffc107; background: #fffbf0;">
                        <div class="task-info">
                            <div class="dish-name">{{ item.TenMon }} <span class="badge bg-warning text-dark">Tổng: {{ item.SoLuong }}</span></div>
                            <div class="dish-meta">Gộp nhiều bàn</div>
                            <div class="dish-note text-muted small"><i class="fas fa-info-circle"></i> Bấm nút nấu tất cả để nấu hết</div>
                        </div>
                        <button class="btn-action" onclick="updateStatus('{{ item.IDs }}', 'DangCheBien')">
                            nấu tất cả {{ item.SoLuong }}
                        </button>
                    </div>
                {% else %}
                    <div class="task-card">
                        <div class="task-info">
                            <div class="dish-name">1. {{ item.mon_an.TenMon }} <span class="dish-qty">x{{ item.SoLuong }}</span></div>
                            <div class="dish-meta">
                                Order #{{ '%04d' % item.MaHoaDon }} | <span class="fw-bold text-decoration-underline">Bàn số {{ item.hoa_don.SoBan }}</span>
                            </div>
                            <div class="text-muted small mt-1"><i class="far fa-clock"></i> {{ item.ThoiGianGoi.strftime('%H:%M:%S') }}</div>
                            {% if item.GhiChu %}<div class="dish-note">Note: {{ item.GhiChu }}</div>{% endif %}
                        </div>
                        <button class="btn-action" onclick="updateStatus('{{ item.MaChiTiet }}', 'DangCheBien')">bắt đầu nấu</button>
                    </div>
                {% endif %}
            {% else %}
                <div class="text-center text-muted mt-5"><i class="fas fa-check-circle fa-3x mb-3" style="color:#ddd;"></i><p>Hết món chờ!</p></div>
            {% endfor %}
        </div>
    </div>

    <div class="col-cooking">
        <div class="col-header">
            <div class="col-title">cooking</div>
            <div class="tab-group"><div class="nav-tab-item active">Dish</div></div>
        </div>
        <div style="height: 2px; background: #333; width: 100%; margin-top: -2px;"></div>

        <div class="task-list">
            {% for item in cooking_list %}
            <div class="task-card" style="border-color: #4e73df; box-shadow: 4px 4px 0px rgba(78,115,223,0.2);">
                <div class="task-info" style="max-width: 75%;">
                    <div class="dish-name text-primary">{{ item.mon_an.TenMon }} <span class="dish-qty bg-primary">x{{ item.SoLuong }}</span></div>
                    <div class="dish-meta">Order #{{ '%04d' % item.MaHoaDon }} | <span class="fw-bold">Bàn số {{ item.hoa_don.SoBan }}</span></div>
                    <div class="text-muted small mt-1"><i class="fas fa-fire text-warning"></i> Đang nấu...</div>
                    {% if item.GhiChu %}<div class="dish-note">Note: {{ item.GhiChu }}</div>{% endif %}
                </div>
                <button class="btn-action btn-done" onclick="updateStatus('{{ item.MaChiTiet }}', 'HoanTat')">xong</button>
            </div>
            {% else %}
                <div class="text-center text-muted mt-5"><i class="fas fa-utensils fa-2x mb-3" style="color:#ddd;"></i><p>Bếp đang rảnh.</p></div>
            {% endfor %}
        </div>
    </div>

</div>

<a href="{{ url_for('main.logout') }}" class="logout-btn"><i class="fas fa-sign-out-alt"></i>Đăng xuất</a>

<script>
    function updateStatus(id, status) {
        fetch('/api/update-status', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ id: id, status: status })
        })
        .then(r => r.json())
        .then(data => {
            if(data.success) location.reload();
        });
    }

    setTimeout(() => window.location.reload(), 30000);
</script>

</body>
</html>